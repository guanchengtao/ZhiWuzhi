/*
Copyright (c) 2003-2011, CKSource - Frederico Knabben. All rights reserved.
For licensing, see LICENSE.html or http://cKeditor.com/license
*/

(function(){CKeDITOR.config.jqueryOverrideVal=typeof CKeDITOR.config.jqueryOverrideVal=='undefined'?true:CKeDITOR.config.jqueryOverrideVal;var a=window.jQuery;if(typeof a=='undefined')return;a.extend(a.fn,{cKeditorGet:function(){var b=this.eq(0).data('cKeditorInstance');if(!b)throw 'CKeditor not yet initialized, use cKeditor() with callback.';return b;},cKeditor:function(b,c){if(!CKeDITOR.env.isCompatible)return this;if(!a.isFunction(b)){var d=c;c=b;b=d;}c=c||{};this.filter('textarea, div, p').each(function(){var e=a(this),f=e.data('cKeditorInstance'),g=e.data('_cKeditorInstanceLock'),h=this;if(f&&!g){if(b)b.apply(f,[this]);}else if(!g){if(c.autoUpdateElement||typeof c.autoUpdateElement=='undefined'&&CKeDITOR.config.autoUpdateElement)c.autoUpdateElementJquery=true;c.autoUpdateElement=false;e.data('_cKeditorInstanceLock',true);f=CKeDITOR.replace(h,c);e.data('cKeditorInstance',f);f.on('instanceReady',function(i){var j=i.editor;setTimeout(function(){if(!j.element){setTimeout(arguments.callee,100);return;}i.removeListener('instanceReady',this.callee);j.on('dataReady',function(){e.trigger('setData.cKeditor',[j]);});j.on('getData',function(l){e.trigger('getData.cKeditor',[j,l.data]);},999);j.on('destroy',function(){e.trigger('destroy.cKeditor',[j]);});if(j.config.autoUpdateElementJquery&&e.is('textarea')&&e.parents('form').length){var k=function(){e.cKeditor(function(){j.updateElement();});};e.parents('form').submit(k);e.parents('form').bind('form-pre-serialize',k);e.bind('destroy.cKeditor',function(){e.parents('form').unbind('submit',k);e.parents('form').unbind('form-pre-serialize',k);});}j.on('destroy',function(){e.data('cKeditorInstance',null);});e.data('_cKeditorInstanceLock',null);e.trigger('instanceReady.cKeditor',[j]);if(b)b.apply(j,[h]);},0);},null,null,9999);}else CKeDITOR.on('instanceReady',function(i){var j=i.editor;setTimeout(function(){if(!j.element){setTimeout(arguments.callee,100);return;}if(j.element.$==h)if(b)b.apply(j,[h]);},0);},null,null,9999);});return this;}});if(CKeDITOR.config.jqueryOverrideVal)a.fn.val=CKeDITOR.tools.override(a.fn.val,function(b){return function(c,d){var e=typeof c!='undefined',f;this.each(function(){var g=a(this),h=g.data('cKeditorInstance');if(!d&&g.is('textarea')&&h){if(e)h.setData(c);else{f=h.getData();return null;}}else if(e)b.call(g,c);else{f=b.call(g);return null;}return true;});return e?this:f;};});})();
