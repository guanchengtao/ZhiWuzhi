/*
Copyright (c) 2003-2011, CKSource - Frederico Knabben. All rights reserved.
For licensing, see LICENSE.html or http://cKeditor.com/license
*/

(function(){var a=/\[\[[^\]]+\]\]/g;CKeDITOR.plugins.add('placeholder',{requires:['dialog'],lang:['en','he'],init:function(b){var c=b.lang.placeholder;b.addCommand('createplaceholder',new CKeDITOR.dialogCommand('createplaceholder'));b.addCommand('editplaceholder',new CKeDITOR.dialogCommand('editplaceholder'));b.ui.addButton('CreatePlaceholder',{label:c.toolbar,command:'createplaceholder',icon:this.path+'placeholder.gif'});if(b.addMenuItems){b.addMenuGroup('placeholder',20);b.addMenuItems({editplaceholder:{label:c.edit,command:'editplaceholder',group:'placeholder',order:1,icon:this.path+'placeholder.gif'}});if(b.contextMenu)b.contextMenu.addListener(function(d,e){if(!d||!d.data('cKe-placeholder'))return null;return{editplaceholder:CKeDITOR.TRISTATE_OFF};});}b.on('doubleclick',function(d){if(CKeDITOR.plugins.placeholder.getSelectedPlaceHoder(b))d.data.dialog='editplaceholder';});b.addCss('.cKe_placeholder{background-color: #ffff00;'+(CKeDITOR.env.gecko?'cursor: default;':'')+'}');b.on('contentDom',function(){b.document.getBody().on('resizestart',function(d){if(b.getSelection().getSelectedElement().data('cKe-placeholder'))d.data.preventDefault();});});CKeDITOR.dialog.add('createplaceholder',this.path+'dialogs/placeholder.js');CKeDITOR.dialog.add('editplaceholder',this.path+'dialogs/placeholder.js');},afterInit:function(b){var c=b.dataProcessor,d=c&&c.dataFilter,e=c&&c.htmlFilter;if(d)d.addRules({text:function(f){return f.replace(a,function(g){return CKeDITOR.plugins.placeholder.createPlaceholder(b,null,g,1);});}});if(e)e.addRules({elements:{span:function(f){if(f.attributes&&f.attributes['data-cKe-placeholder'])delete f.name;}}});}});})();CKeDITOR.plugins.placeholder={createPlaceholder:function(a,b,c,d){var e=new CKeDITOR.dom.element('span',a.document);e.setAttributes({contentEditable:'false','data-cKe-placeholder':1,'class':'cKe_placeholder'});c&&e.setText(c);if(d)return e.getOuterHtml();if(b){if(CKeDITOR.env.ie){e.insertAfter(b);setTimeout(function(){b.remove();e.focus();},10);}else e.replace(b);}else a.insertElement(e);return null;},getSelectedPlaceHoder:function(a){var b=a.getSelection().getRanges()[0];b.shrink(CKeDITOR.SHRINK_TEXT);var c=b.startContainer;while(c&&!(c.type==CKeDITOR.NODE_ELEMENT&&c.data('cKe-placeholder')))c=c.getParent();return c;}};
